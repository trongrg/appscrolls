# >---------------------------------------------------------------------------<
#
#                   ___               ____             ____
#                  / _ | ___  ___    / __/__________  / / /__
#                 / __ |/ _ \/ _ \  _\ \/ __/ __/ _ \/ / (_-<
#                /_/ |_/ .__/ .__/ /___/\__/_/  \___/_/_/___/
#                     /_/  /_/
#
#   This template was generated by App Scrolls, the amazing and awesome Rails
#     application template builder. Get started at http://appscrolls.org
#
# >---------------------------------------------------------------------------<

# >----------------------------[ Initial Setup ]------------------------------<

<%= render "helpers" %>

# END MODULE

require 'bundler'
Bundler.with_clean_env do

unless File.exists?('config/initializers/generators.rb')
  initializer 'generators.rb', <<-RUBY
  Rails.application.config.generators do |g|
  end
  RUBY
end

@scrolls = <%= resolve_scrolls.map(&:key).inspect %>
config ||= {}
config.extend ConfigMapper

@current_scroll = nil
@configs = {}

define_callback :before_everything
define_callback :after_bundler
define_callback :after_everything
define_callback :finally

<% resolve_scrolls.each do |scroll| %>
<%= render 'scroll', scroll.get_binding %>
<% end %>

execute_callbacks :before_everything

<% if custom_code? %># >-----------------------------[ Custom Code ]-------------------------------<

<%= custom_code %><% end %>

@current_scroll = nil

# >-----------------------------[ Run Bundler ]-------------------------------<

say_wizard "Running Bundler install. This will take a while."
  run "bundle install"

git_commit("bundle install") if use_git?

execute_callbacks :after_bundler
execute_callbacks :after_everything
execute_callbacks :finally

end
